os: linux
dist: jammy
language: python
python:
  - "3.7"
  - "3.8"
  - "3.9"
  - "3.10"
  - "3.11"
env:
  TOX_PYTHON=python
addons:
  apt:
    packages:
      - "python3-pip"
      - "python3-venv"
before_install:
  - /usr/bin/python -m pip install pipx --user
install:
  - pipx install --python=$TOX_PYTHON tox
  - pipx inject --pip-args='--upgrade' tox setuptools 
  - pipx install poetry
  - pipx inject poetry poetry-dynamic-versioning
script:
  - export TOXENV=$(python -V | sed -E 's/Python ([2-3]).([0-9]+?).[0-9]+/py\1\2/g')
  - tox

jobs:
  include:
    - dist: focal
      python: "3.6"
      env:
        TOX_PYTHON=/usr/bin/python3.8
      before_install:
        - /usr/bin/python3.8 -m pip install pipx --user
