id: _definitions

UUID:
    type: string
    pattern: "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"

parent_uuids:
    type: array
    minItems: 1
    items:
        $ref: "#/UUID"
    uniqueItems: true

foreign_key:
    type: object
    # Allow true here because we can have other unique keys defined on
    # a target type
    additionalProperties: True
    #Can either use 'id' which are GDC IDs (UUID) or 'submitter_id'
    #which are user defined IDs ("submitter IDs in the backend")
    properties:
        id:
            $ref: "#/UUID"
        submitter_id:
            type: string

to_one:
  anyOf:
    - type: array
      items:
        $ref: "#/foreign_key"
        minItems: 1
        maxItems: 1
    - $ref: "#/foreign_key"

to_many:
  anyOf:
    - type: array
      items:
        $ref: "#/foreign_key"
        minItems: 1
    - $ref: "#/foreign_key"

datetime:
  oneOf:
    - type: string
      format: date-time
    - type: 'null'

file_name:
    type: string
    description: "file name"
file_size:
    type: number
    description: "the size of the data file (object) in bytes"
file_format:
    type: string
    description: "the size of the data file (object) in bytes"
md5sum:
    type: string
    description: "the MD5 hash of the data file (object)"

release_state:
    description: "Release statesd of an entity"
    default: unreleased
    enum:
      - unreleased
      - released
      - redacted

data_bundle_state:
    description: "states of a data bundle"
    default: submitted
    enum:
        - submitted
        - validated
        - error
        - released
        - suppressed
        - redacted

data_file_error_type:
    description: "type of error"
    enum:
        - file_size
        - file_format
        - md5sum

state:
    description: "states of all entities"
    default: validated
    downloadable:
        - uploaded
        - md5summed
        - validating
        - validated
        - error
        - invalid
        - released
    public:
        - live
    oneOf:
        - enum: #This list covers legacy data
            - uploading
            - uploaded
            - md5summing
            - md5summed
            - validating
            - error
            - invalid
            - suppressed
            - redacted
            - live
        - enum: #This list covers all future data 1/15/16
            - validated
            - submitted
            - released

file_state:
    description: "states for data file objects"
    default: registered
    enum:
        - registered
        - uploading
        - uploaded
        - validating
        - validated
        - submitted
        - processing
        - processed
        - released
        - error

qc_metrics_state:
    enum:
        - FAIL
        - PASS
        - WARN

data_file_properties:
  id:
    $ref: "#/UUID"
    systemAlias: node_id
    description: "TODO"
  submitter_id:
    type:
      - string
      - "null"
    description: "TOREVIEW: the file id assigned by the submitter"
  file_name:
    type: string
    description: "TOREVIEW: the file (object) name"
  file_size:
    type: number
    description: "the size file (object) in bytes"
  md5sum:
    type: string
    description: "The MD5 hash of this file"
  file_state:
    $ref: "#/file_state"
  state:
    $ref: "#/state"
  error_type:
    $ref: "#/data_file_error_type"
  state_comment:
    type: string
    description: >
      TOREVIEW: optional comment about why the file is in the
      current state, mainly for invalid state.
  project_id:
    type: string
  created_datetime:
    $ref: "#/datetime"
  updated_datetime:
    $ref: "#/datetime"

workflow_properties:
  id:
    $ref: "#/UUID"
    systemAlias: node_id
    description: "TODO"
  submitter_id:
    type:
      - string
      - "null"
    description: "TOREVIEW: the file id assigned by the submitter"
  workflow_link:
    description: "Link to github hash for the CWL workflow used."
    type: string
  state:
    $ref: "#/state"
  project_id:
    type: string
  created_datetime:
    $ref: "#/datetime"
  updated_datetime:
    $ref: "#/datetime"
