$schema: "http://json-schema.org/draft-04/schema#"

id: "metaschema"
title: "GDC JSON schema extension"

allOf:
  - "$ref": "http://json-schema.org/draft-04/schema#"

#GDC extensions
required:
  - category #potentially used in submission system, if not may not be needed
  - program
  - project
  - uniqueKeys #for validator to check uniqueness
  - links #to specify to the validator what properties are links and their targets
  - validators #specify to the validator additional functions to run on the values
  - systemProperties #non-user facing values required by backend
  #Require core JSON schema fields here if desired, requiring id
  - id

definitions:
  link_def:
    title: "Define a link to other GDC entities"
    type: object
    required:
      - name
      - link_to_type #entity type being linked
      - multiplicity #multiplicity of this link for validatio

    properties:
      link_to_type:
        type: string

      multiplicity:
        type: string
        enum:
          - one_to_one
          - one_to_many
          - many_to_one
          - many_to_many

  validator_def:
    title: "Define a validator to be used on a property"
    type: object
    required:
      - property #the property to be applied to
      - function #the function name, predefined somewhere, to use

    properties:
      link_to_type:
        type: string

      multiplicity:
        type: string
        enum:
          - one_to_one
          - one_to_many
          - many_to_one
          - many_to_many

properties:
  category:
    type: string
    enum:
      - administrative
      - biospecimen
      - clinical

  unique_keys:
    type: array
    items:
      type: array
      items:
        type: string

  validators:
    type:
      - array
      - "null"

    items:
      $ref: "#/definitions/validator_def"

  system_properties:
    type: array

  links:
    type:
      - array
      - "null"

    items:
      $ref: "#/definitions/link_def"
